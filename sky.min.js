let n=!1;const t=()=>{if(!n){const a=document.createElement("div"),o=(a.className="menu",document.createElement("div"));o.style=`
      max-width: 400px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
    `;let e=[];r.map&&(e=r.map.sort().filter(e=>r[e]?.location!==r.currentLocationName)).map(t=>{var e;r[t].location&&((e=document.createElement("button")).innerText=r[t].name,e.style="width: 80vw;",e.onclick=()=>{const e=document.createElement("div");e.className="outMenu",e.innerHTML=a.innerHTML,n=!1,a.remove(),s(),u(),b(r[t].location)(),document.body.appendChild(e),setTimeout(()=>{e.remove()},400)},o.appendChild(e))});var t=document.createElement("button");t.style="aspect-ratio: 1; font-size: 32pt; font-weight: bold; width: 64px; height: 64px;",t.innerText="⤒",t.onclick=()=>{n=!1,a.remove();const e=document.createElement("div");e.className="outMenu",e.innerHTML=a.innerHTML,document.body.appendChild(e),setTimeout(()=>{e.remove()},400)},0<e.length&&(o.appendChild(t),a.appendChild(o),document.body.appendChild(a))}};let r={},l={};const d=(e,t=!1)=>{let a=0;const o=t?"div":"p";return e.split("\n").map(e=>e.trim()).join("\n").split("\n\n").filter(e=>""!==e).map(e=>`<${o}>${(o=>{const n={quote:!0,bold:!0,italic:!0};var e=(e,t,a)=>{for(;-1<o.indexOf(e);)o=n[t]?o.replace(e,`<${a}>`):o.replace(e,`</${a}>`),n[t]=!n[t]},t=(t,a)=>o=o.split("\n").map(e=>0===e.trimStart().indexOf(t)?`<${a}>${e.replace(t,"")}</${a}>`:e).join("\n");for(t("#### ","h4"),t("### ","h3"),t("## ","h2"),t("# ","h1");-1<o.indexOf("[[");)o=a%2==0?o.replace("[[","&ldquo;"):o.replace("[[","&lsquo;"),a+=1;for(;-1<o.indexOf("]]");)--a,o=a%2==0?o.replace("]]","&rdquo;"):o.replace("]]","&rsquo;");for(e("``","quote","q"),e('"',"quote","q"),e("**","bold","b"),e("*","italic","i");-1<o.indexOf("'");)o=o.replace("'","&rsquo;");return o=o.trim()})(e)}</${o}>`).join("")};function h(e){var t=0;if(0!=e.length)for(i=0;i<e.length;i++)t=(t<<5)-t+(char=e.charCodeAt(i)),t&=t;return t}Game.Stockford={name:"Stockford",location:"outsideShip",talkLabel:"Hey, Yates",hasMet:!1,desc:`
    
    A sturdy little man with very black hair and a wide nose sat
    studying me from a table in the corner. He clutched a tin
    cup that may have been full of coffee or rum; it was
    impossible to tell from a distance.
    
    `},Game.yates={name:"Yates",location:"outsideShip",talkLabel:"Hey, Yates",hasMet:!0,desc:`
  
  Yates' legs are sticking out from under the wreckage as he endeavors to fix what remains of your space-faring vessel.
  It doesn't sound promising under there.
  
  `,talk:()=>{w(`
          
        Yates is (literally) your second hand man; a 50/50 medley of robotic and organic components, cobbled into a hodge-podge of an android. 
        The bio stuff is cut-rate, to say the least, likely because he sustains every six hours or so with junk food and their abundant hydrocarbons.
        Thus, he constantly smells vaguely of processed cheese dust.
    
        He peers blandly at you from beneath the hull.
          
        `),c("Tell me again why your name is Yates",()=>{w(`
                  
            "Actually," says Yates, "My true designation is Cybernetic Reploid model 88, or CR-88.
            My first owner called my Crazy 8's, then my next owner called
            me Eights, and finally the last one called my Yates."
        `)}),e([["Can't you work any faster?",[`
      
      "I'm working as fast as I can", he grumbled.
      
      `,`
      
      Yates glares at you angrily.
      
      `]],["Is it the fuel regulator?",`
      
      "No", says Yates, "We just replaced that only two months ago and it's brand new."
      
      `],["Is it the auxiliary coolant bypass?",`
      
      Yates shook his head. "No, it's still bypassing coolant just fine."
      
      `],["Is it the thermal plasma valve?",`
      
      "Checked that," Yates shook his head. "Works fine still."
      
      `],["Well, what else could it be?",()=>{f("annoyed"),w(`
      
        "Look," says Yates with barely restrained annoyance, "Unless you suddenly become an expert at ship repair, please go away."
      
        `)}]]),g("Well, keep working, we've got to get off this rock",()=>{w("Yates nods and buries himself in repair work. A shade of anxiety crosses your mind that he may not know what he's doing.")})},annoyed:()=>{w(`
      
      Yates glares at you as he continues working. He seemed pretty annoyed.
      
      `),c("Can't you work any faster?",`
      
      "I don't want to be stuck on this stupid planet, either," says Yates with a sour look.
      
    `),c("Thank you for working so hard, Yates",()=>{f(),w(`
        
        "Thanks. I'm going as fast as I can," he mumbled in between licking Raspberry Soda off the exposed engine chassis.
        
        `)}),g("Well, keep working, we've got to get off this rock")}},Game.crimeScene=()=>{w(`
    
    The captain's room was dark. His body was on the bed, the ghastly visage of death
    on his face lit only by moonlight through the window. Luggage boxes where everywhere,
    as though thrown about the cargo hold of a ship, so there was only a narrow path
    of floor to walk. 
    
    `),c("Examine the captain",`
    
    Under the sheets, Bennett was naked. Judging by the state of the rigor mortis,
    I ascertained he had been dead less than a few hours. The trachea in the neck was crushed.
    
    `),c("Examine the window",`
    
    The caked layers of dust and told me the window had not been opened in years, and for a fact,
    could not be opened without the force of ten men.
    
    `),c("Examine the chests",()=>{x("foundHiddenChest",!0),w(`
    
    Most of the chests were empty. A few had some useless baubles acquired from more
    distant regions.

    One chest in particular struck me as unusual.
    
    `)}),I("foundHiddenChest")&&c("Examine the unusual chest",`
    
    The strange chest was no more than about 3 foot long and 2 foot wide. There was a latch
    on the lock so it could be opened on the inside. It was empty, save for the rude odor
    of sweat and leather.

    Carved near the bottom on the outside were two letters: LH.
    
    `),c("Exit the crime scene",b("manorHouseFoyer"))},Game.manorHouseFoyer=()=>{w(`
    
    The captain's taste was opulent and international. Large brass Arabic lamps flickered gently over
    lavish French furniture and Cantonese rugs. It seemed to me that the home reflected the
    man himself; well traveled, and pilfering trinkets where-ever he went.
    
    A clearly annoyed Deputy Inspector Bixby was dutifully waiting to aid me in my investigation.

    `),c('"Bixby, show me the crime scene."',()=>{w(`
            "Very well."
        `),b("crimeScene")()}),c('"Bixby, I will interview Mrs. Werstrom."',()=>{w(`
            "Very well."
        `),b("interviewWerstrom")()}),c('"Bixby, I will interview Mr. Thurman."',()=>{w(`
            "Very well."
        `),b("interviewThurman")()}),c('"What do you think, Bixby?"',()=>{w('"What do you think, Bixby?" I asked.'),w([`"You're the China Doll," he said with a note of derision. "Are you not the 
            nimblest mind in Europe?"`,'He shrugged. "Why are *you* asking me?"',"Bixby only scowled at the question."])})},Game.myShip={stillHere:!0},Game.cockpit=()=>{w(`
          
    Your command chair is surrounded by an array of screens, lights and controls telling you every detail
    of what's happening on your ship. Right now, they're all very upset for some reason. A distant alarm
    echoes from the engine cavity. A sturdy metal ladder descends to the main deck.
  
    `),c("Sit in the chair","You sit in the command chair and feel very heroic."),c("Look out the window",`
  
    The purple sky and distant golden mountains don't resemble any planet you've visited before.
  
  `),c("Climb down to the Main Deck",b("mainDeck"))},Game.mainDeck=()=>{w(`
      
    This part of the ship is the least damaged—it's a pretty good thing you were in here during the crash. The hyper-sleep pod is depowered,
    along with most everything else on this deck. Yates will probably have all the systems on and off about a hundred times before
    we can limp to a repair shop.
      
    `),c("Go to the cockpit",b("cockpit")),c("Exit the ship",b("outsideShip"))},Game.outsideShip=()=>{w(`
      
    In a crumpled heap, your ship lies at edge of a high cliff.
    Far below a cluster of sun-bleached domes make up a humble village.
      
    `),a()&&v(50)&&w(k(["A big pink cloud poofs on by over the horizon.","A gentle breeze blows peacefully.","Some distant animal squawks mournfully from the valley below."])),c("Admire the view",`
  
    A wide sea stretches beyond the cliff's edge, sparkling in the bright crisp morning air.

    `),c("Assess my ship",`
    It's a CM6305 Talon Class Explorer ship, fitting for a space explorer-for-hire such as yourself. For certain, it's seen better days,
    even before this morning's landing. Currently, Yates ${k(["has coolant spilled all over the hull","is tightening bolts on a rusted structural support","is pulling a fuel hose from under the engine"])}.
    
    `),c("Enter the ship",b("mainDeck")),c("Go down to the village",b("cityEntrance"))},Game.start=()=>{w(`

    # The Secret of the Black Walrus Society
    
    ## A game by spaceflounder
    
    `),c("Start",b("intro1"))},Game.intro1=()=>{w(`

    ### London Chinatown, 1884

    You've never read about me in the papers, or in any journal. You can
    call me Madame Soo. Sometimes, at Scotland Yard, they call me the China Doll.
    They are not entirely a bad lot, I suppose. But when the police find 
    themselves truly baffled, they come to me.

    Thus, when there was an urgent knock on the door of my small parlour off West India Dock Road, I knew precisely who
    would be on the other side.
    
    `),c("Open the door",b("intro2")),c("Wait",b("intro1_1"))},Game.intro1_1=()=>{w(`

    The rap on my door came again, more insistent this time.
    
    `),c("Open the door",b("intro2")),c("Wait",b("intro1_1"))},Game.intro2=()=>{w(`

    Chief Inspector Gould's face appeared in the dim moonlight.
    "Good evening, Madame Soo," he said, entering as
    swiftly as he could and shutting the door behind him.

    "Good evening, Inspector," I replied. As a tall
    pale gaunt Englishman, he possessed superior skill in looking dour.
          
    `),c('"This is scarcely a decent hour."',()=>{w(`
    
    "This is scarcely a decent hour," I said. "Nearly a quarter of eight."

    "True," said the Inspector, "But this is scarcely a decent place. I should be quite gay indeed not to 
    venture deep into Limehouse each time I needed your inimitable skills."

    `),c('"Then I shall assume the matter is of murder."',b("intro3"))}),c(`"Shouldn't you be at the Underwood Club?"`,()=>{w(`
    
    "Shouldn't you be at the Underwood Club?" I asked. "Surely Merrington and his fellows are grieved
    to have lost their favored pigeon at whist."

    "Ha, ha." Gould was hardly pleased. "One day I shall be most glad to ascertain how you have come
    to be aware of my whist habits, or my associates, as Underwood is a private gentleman's club."

    "You're at a loss, for I am no gentleman," I said.

    "For a certainty you are not."
    
    `),c('"Then I shall assume it is a matter of murder."',b("intro3"))})},Game.intro3=()=>{w(`
          
  "Then I shall assume the matter is of murder," I said, "And likely a figure of some importance."

  "You are wholly correct," said Gould, his face grim. "Might I convey the particulars of the case
  on the way? I have a hansom waiting for us." 


    `),c('"I will exact my usual fee, of course."',b("intro4"))},Game.intro4=()=>{w(`
          
  I nodded. "I will exact my usual fee, of course."

  "Per our usual arrangement," said the Inspector. Soon we were out of my parlour and in the hot dark
  of summer in Canary Wharf. The air was thick with tar and cheap tobacco. The dock never sleeps.

  The cabbie nodded as we took our seats, and with a flick of his wrist we were headed
  north. "You've heard of Captain Roger Bennett?"

    `),c(`"Captain Bennett, of the Queen's navy?"`,()=>{w(`
    
    "Captain Bennett, of the Queen's navy?" I replied.

    "The same," said Gould, "Though he was more a privateer than the navy man you've read about in the papers.
    Bennett was a bachelor, living with a housekeeper and a gardener. At about half past six this evening he retired to his
    bedroom. The door to his room was shut and locked. A few minutes later, the housekeeper, a certain
    Mrs. Werstrom, heard an awful scream from the bedroom."
    
    `),c('"Was the door still locked?"',()=>{w(`
        
        "Was the door still locked?" I asked.

        "It was," said Gould, "The gardener, Mr. Thurman, is a capable man and handy with tools. He removed the knob and they
        found Bennett perished by strangulation in his bed."
        
        `),c('"I assume the crime scene is as you found it."',b("intro5"))})}),c(`"I've heard of him."`,()=>{w(`
    
    "I've heard of him," I said.

    Gould nodded. "In truth, he was more a privateer than the navy man you've read about in the papers.
    Bennett was a bachelor, living with a housekeeper and a gardener. At about half past six this evening he retired to his
    bedroom. The door to his room was shut and locked. A few minutes later, the housekeeper, a certain
    Mrs. Werstrom, heard an awful scream from the bedroom."
    
    `),c('"And the door was still locked."',()=>{w(`
        
        "And the door was still locked," I said.

        "It was," said Gould, "The gardener, Mr. Thurman, is a capable man and handy with tools. He removed the knob and
        found Bennett perished by strangulation in his bed."
        
        `),c('"I assume the crime scene is as you found it."',b("intro5"))})})},Game.intro5=()=>{w(`

      I nodded. "I assume the crime scene is as you found it."

      "Exactly as we found it," said the Inspector. "Mrs. Werstrom and Mr. Thurman are also present to interview."
    
    `),c('"Excellent!"',b("intro6"))},Game.intro6=()=>{w(`

      "Excellent!" I said. "Thank you, Chief Inspector."

      "I shall only hope you may shed some light on this strange and sinister business," said Gould with a dark scowl.
      
      Soon our hansom arrived at the gate of a wide rolling lawn, blue under the light of the moon. Beyond the lawn
      was a tall manor house, a black shadowy tower by night.

      "Stay here," Gould instructed the cabbie as we departed, "I'll be back shortly."
    
    `),c("Proceed to the manor house",b("intro7"))},Game.intro7=()=>{w(`

      We stood on a wide stone porch in nearly total darkness. The door swung open to reveal
      Bixby, Chief Inspector Gould's assistant deputy. Whereas Gould exhibited occasional glimmers
      of brilliance, Bixby had a mind like a lightless cellar.

      "Good news, Chief Inspector," he said. "I've cracked the case. It would seem you've fetched the
      China Doll in vain."
      
    `),c('"Most pleased to see you as well, Bixby."',()=>{w('"Most pleased to see you as well, Bixby," I grumbled.'),b("intro8")()}),c('"Hmm. What is your theory, Mr. Bixby?"',()=>{w('I was more curious than offended. "Hmm. What is your theory, Mr. Bixby?"'),b("intro8")()})},Game.intro8=()=>{w(`

      "The case is simplicity itself," said Bixby with a broadening grin. Bixby was
      fairly young for his position, though he appeared older owing to some girth
      and his thick copper mustache. "You know how 
      Mrs. Werstrom found the body?"

      "Yes," nodded Gould.

      "How do we know she isn't the murderer?"

      "The 90 pound, 60-year old housekeeper managed to choke the still-robust captain of
      the Queen's navy," said Gould. "I think we may perhaps have some keener results from the
      so-called China Doll, eh Madame Soo?"
      
    `),c("Enter the house",()=>{w(`
    
    "I've business still at Scotland Yard, so I must leave," said Gould to me, "But I shall return later tonight
    to confer on the investigation. Bixby," he addressed the assistant deputy, "Please ensure Madame
    Soo has everything she asks for. She is in charge in my absence."

    Bixby mumbled something I was glad to not have heard.
    
    `),b("manorHouseFoyer")()})},window.addEventListener("load",()=>{var e;r={...Game},(e=document.createElement("div")).className="topBar",e.onclick=t,document.body.appendChild(e),u(),b("start")()});const e=e=>{const[t,a]=e.shift(),[o,n]=e.pop(),s="stack-function-"+h(t);l[s]=()=>{"function"==typeof a?a():w(a),e.map(e=>{var[e,t]=e;{var a=t;const o="d"+h(e);r[o]||c(e,()=>{r[o]=!0,"function"==typeof a?a():w(a)})}}),0===e.map(e=>void 0!==r["d"+h(e[0])]).filter(e=>!0!==e).length&&c(o,()=>{f(),"function"==typeof n?n():w(n)})},c(t,()=>{f(s),l[s]()})},s=()=>{document.getElementsByClassName("main")[0].remove(),r.buttonCount=0},u=()=>{let e=document.getElementsByClassName("topRoot")[0];var t=document.createElement("div"),a=document.createElement("div"),o=document.createElement("btns");e||((e=document.createElement("div")).className="topRoot",document.body.appendChild(e)),e.appendChild(t),t.className="main",t.id="main",a.className="page",a.id="page",o.className="btns",o.id="btns",e.appendChild(t),t.appendChild(a),t.appendChild(o)},c=(o,n,e)=>{var t=document.getElementById("btns");if(!(t&&o&&n))throw"Button could not be constructed! With options: "+o;r.buttonCount||(r.buttonCount=0),r.buttonCount+=1,o=o.trim();var a=document.createElement("button");a.type="button",a.onclick=()=>{var e=document.getElementsByClassName("main")[0].innerHTML,t=(s(),r.isTalking&&(t=l?.state??"talk",a=l[t]["btn-"+o]??0,r.lastButtonPressed=o,l[t]["btn-"+o]=a+1),document.createElement("div")),a=(t.className="outPage",t.id="outPage",t.innerHTML=e,document.getElementsByClassName("topRoot")[0]);a&&a.appendChild(t),setTimeout(()=>{document.getElementById("outPage").remove(),window.scrollTo(0,0),u(),"function"==typeof n?n():w(n),!r.env||!r.isTalking&&r.buttonCount||w(r.env()),!r.buttonCount&&r.lastNode&&c("➜",()=>{r.lastNode&&r.lastNode()})},450)},a.className="button",a.innerHTML=`<div class='buttonText'>${d(o,!0)}</div>`,e?t.prepend(a):t.appendChild(a)},m=e=>e[0].toUpperCase()+e.slice(1);const p=e=>(e=e||r.isTalking,y(e)?[r[e].name,"","",""]:[r[e].name,"a","the","that"]);const y=e=>(e=e||r.isTalking,r[e].hasMet);const f=(e,t)=>{e=e??"talk";t=t||r.isTalking,r[t].state=e,r.isTalking===t&&(r.lastNode=r[t][e])},a=e=>{return e=e||r.currentLocationName,r[e].visited??0},o=e=>{e=e||r.isTalking,r.map||(r.map=[]),r[e]&&r[e].location&&-1===r.map.indexOf(e)&&r.map.push(e)},g=(e,t)=>{c(e,()=>{t?(t(),c("➜",()=>{b(r.currentLocationName)(),r.isTalking=""})):(b(r.currentLocationName)(),r.isTalking="")})};const w=e=>{var t=document.getElementById("page");if(t)if(Array.isArray(e)){var a=e;const s=a[0];var o="i"+(()=>{let e=0;if(0!=s.length)for(i=0;i<s.length;i++){var t=s.charCodeAt(i);e=(e<<5)-e+t,e&=e}return e})(),n=r[o]??0;n?(w(a[n]),n<a.length-1&&(r[o]=n+1)):(r[o]=1,w(s))}else"string"==typeof e?t.innerHTML+=d(e):"function"==typeof e&&(t.innerHTML+=d(e()))},b=t=>{const a=()=>{Object.keys(r).map(e=>{var t,a;r[e]?.location&&r.currentLocationName===r[e]?.location&&(t=(e=>{e=e||r.isTalking;var[t,,a]=p(e),o=r[e].state??"talk";if(!y(e)&&r[e].notMet){if("function"==typeof r[e].notMet)return r[e].notMet();if("object"==typeof r[e].notMet&&r[e].notMet[o]){if("function"==typeof r[e].notMet[o])return r[e].notMet[o]();if("string"==typeof r[e].notMet[o])return r[e].notMet[o]}return r[e].notMet??m(a+` ${t} is here.`)}if("function"==typeof r[e].desc)return r[e].desc();if("object"==typeof r[e].desc&&r[e].desc[o]){if("function"==typeof r[e].desc[o])return r[e].desc[o]();if("string"==typeof r[e].desc[o])return r[e].desc[o]}return r[e].desc??m(a+` ${t} is here.`)})(e),w(t),r[e].talk)&&c((e=>{e=e||r.isTalking;var[t,,a,,]=p(e);return r[e].talkLabel?"string"==typeof r[e].talkLabel?r[e].talkLabel:r[e].talkLabel():`Talk to ${a} `+t})(e),(a=e,()=>{r.isTalking=a,(l=r[a]).hasMet=!0;var e=l?.state??"talk";o(),1!==r?.map?.length||r.showFastTravelTip||(r.showFastTravelTip=1),r[a][e](),r.lastNode=r[a][e]}),!0)})};return()=>{r.currentLocationName=t;var e=()=>{var e=r[t]?.visited??0;r.env=null,r.isTalking="",r[t](),a(),r[t].visited=e+1,1===r.showFastTravelTip&&r[r.map[0]].location!==r.currentLocationName&&(r.showFastTravelTip=2,T("Hey there! You can now fast travel to characters you meet by tapping the top ⤴ of the screen"))};e(),r.lastNode=e}},v=e=>e>=Math.floor(100*Math.random());const k=e=>{var t=`p{${h(e.join("-"))}}`;return r[t]&&r[t]?.length||(r[t]=(e=>{let t=e.length,a;for(;0!=t;)a=Math.floor(Math.random()*t),t--,[e[t],e[a]]=[e[a],e[t]];return e})([...e])),r[t].pop()},T=e=>{const t=document.createElement("div");t.className="tipBox",t.id="tipBox";var a=document.createElement("div"),o=(a.className="tipInnerBox",a.id="tipInnerBox",document.createElement("div"));o.className="tipInnerText",o.id="tipInnerText",o.innerText=e,a.appendChild(o),t.appendChild(a),t.onclick=()=>t.remove(),document.body.appendChild(t)},I=e=>(r.values||(r.values={}),r.values[e]??!1),x=(e,t)=>{r.values||(r.values={}),r.values[e]=t};