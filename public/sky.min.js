let n=!1;const t=()=>{if(!n){const a=document.createElement("div"),o=(a.className="menu",document.createElement("div"));o.style=`
      max-width: 400px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
    `;let e=[];r.map&&(e=r.map.sort().filter(e=>r[e]?.location!==r.currentLocationName)).map(t=>{var e;r[t].location&&((e=document.createElement("button")).innerText=r[t].name,e.style="width: 80vw;",e.onclick=()=>{const e=document.createElement("div");e.className="outMenu",e.innerHTML=a.innerHTML,n=!1,a.remove(),s(),c(),w(r[t].location)(),document.body.appendChild(e),setTimeout(()=>{e.remove()},400)},o.appendChild(e))});var t=document.createElement("button");t.style="aspect-ratio: 1; font-size: 32pt; font-weight: bold; width: 64px; height: 64px;",t.innerText="⤒",t.onclick=()=>{n=!1,a.remove();const e=document.createElement("div");e.className="outMenu",e.innerHTML=a.innerHTML,document.body.appendChild(e),setTimeout(()=>{e.remove()},400)},0<e.length&&(o.appendChild(t),a.appendChild(o),document.body.appendChild(a))}};let r={},l={};const d=(e,t=!1)=>{let a=0;const o=t?"div":"p";return e.split("\n").map(e=>e.trim()).join("\n").split("\n\n").filter(e=>""!==e).map(e=>`<${o}>${(o=>{const n={quote:!0,bold:!0,italic:!0};var e=(e,t,a)=>{for(;-1<o.indexOf(e);)o=n[t]?o.replace(e,`<${a}>`):o.replace(e,`</${a}>`),n[t]=!n[t]},t=(t,a)=>o=o.split("\n").map(e=>0===e.trimStart().indexOf(t)?`<${a}>${e.replace(t,"")}</${a}>`:e).join("\n");for(t("#### ","h4"),t("### ","h3"),t("## ","h2"),t("# ","h1");-1<o.indexOf("[[");)o=a%2==0?o.replace("[[","&ldquo;"):o.replace("[[","&lsquo;"),a+=1;for(;-1<o.indexOf("]]");)--a,o=a%2==0?o.replace("]]","&rdquo;"):o.replace("]]","&rsquo;");for(e("``","quote","q"),e('"',"quote","q"),e("**","bold","b"),e("*","italic","i");-1<o.indexOf("'");)o=o.replace("'","&rsquo;");return o=o.trim()})(e)}</${o}>`).join("")};function h(e){var t=0;if(0!=e.length)for(i=0;i<e.length;i++)t=(t<<5)-t+(char=e.charCodeAt(i)),t&=t;return t}Game.yates={name:"Yates",location:"outsideShip",talkLabel:"Hey, Yates",hasMet:!0,desc:`
  
  Yates' legs are sticking out from under the wreckage as he endeavors to fix what remains of your space-faring vessel.
  It doesn't sound promising under there.
  
  `,talk:()=>{b(`
          
        Yates is (literally) your second hand man; a 50/50 medley of robotic and organic components, cobbled into a hodge-podge of an android. 
        The bio stuff is cut-rate, to say the least, likely because he sustains every six hours or so with junk food and their abundant hydrocarbons.
        Thus, he constantly smells vaguely of processed cheese dust.
    
        He peers blandly at you from beneath the hull.
          
        `),u("Tell me again why your name is Yates",()=>{b(`
                  
            "Actually," says Yates, "My true designation is Cybernetic Reploid model 88, or CR-88.
            My first owner called my Crazy 8's, then my next owner called
            me Eights, and finally the last one called my Yates."
        `)}),e([["Can't you work any faster?",[`
      
      "I'm working as fast as I can", he grumbled.
      
      `,`
      
      Yates glares at you angrily.
      
      `]],["Is it the fuel regulator?",`
      
      "No", says Yates, "We just replaced that only two months ago and it's brand new."
      
      `],["Is it the auxiliary coolant bypass?",`
      
      Yates shook his head. "No, it's still bypassing coolant just fine."
      
      `],["Is it the thermal plasma valve?",`
      
      "Checked that," Yates shook his head. "Works fine still."
      
      `],["Well, what else could it be?",()=>{f("annoyed"),b(`
      
        "Look," says Yates with barely restrained annoyance, "Unless you suddenly become an expert at ship repair, please go away."
      
        `)}]]),g("Well, keep working, we've got to get off this rock",()=>{b("Yates nods and buries himself in repair work. A shade of anxiety crosses your mind that he may not know what he's doing.")})},annoyed:()=>{b(`
      
      Yates glares at you as he continues working. He seemed pretty annoyed.
      
      `),u("Can't you work any faster?",`
      
      "I don't want to be stuck on this stupid planet, either," says Yates with a sour look.
      
    `),u("Thank you for working so hard, Yates",()=>{f(),b(`
        
        "Thanks. I'm going as fast as I can," he mumbled in between licking Raspberry Soda off the exposed engine chassis.
        
        `)}),g("Well, keep working, we've got to get off this rock")}},Game.myShip={stillHere:!0},Game.cockpit=()=>{b(`
          
    Your command chair is surrounded by an array of screens, lights and controls telling you every detail
    of what's happening on your ship. Right now, they're all very upset for some reason. A distant alarm
    echoes from the engine cavity. A sturdy metal ladder descends to the main deck.
  
    `),u("Sit in the chair","You sit in the command chair and feel very heroic."),u("Look out the window",`
  
    The purple sky and distant golden mountains don't resemble any planet you've visited before.
  
  `),u("Climb down to the Main Deck",w("mainDeck"))},Game.mainDeck=()=>{b(`
      
    This part of the ship is the least damaged—it's a pretty good thing you were in here during the crash. The hyper-sleep pod is depowered,
    along with most everything else on this deck. Yates will probably have all the systems on and off about a hundred times before
    we can limp to a repair shop.
      
    `),u("Go to the cockpit",w("cockpit")),u("Exit the ship",w("outsideShip"))},Game.outsideShip=()=>{b(`
      
    In a crumpled heap, your ship lies at edge of a high cliff.
    Far below a cluster of sun-bleached domes make up a humble village.
      
    `),a()&&v(50)&&b(k(["A big pink cloud poofs on by over the horizon.","A gentle breeze blows peacefully.","Some distant animal squawks mournfully from the valley below."])),u("Admire the view",`
  
    A wide sea stretches beyond the cliff's edge, sparkling in the bright crisp morning air.

    `),u("Assess my ship",`
    It's a CM6305 Talon Class Explorer ship, fitting for a space explorer-for-hire such as yourself. For certain, it's seen better days,
    even before this morning's landing. Currently, Yates ${k(["has coolant spilled all over the hull","is tightening bolts on a rusted structural support","is pulling a fuel hose from under the engine"])}.
    
    `),u("Enter the ship",w("mainDeck")),u("Go down to the village",w("cityEntrance"))},Game.start=()=>{b(`

    # Mystery story
    
    ## A game by spaceflounder
    
    `),u("Start",w("intro1"))},Game.intro1=()=>{b(`

    ### London Chinatown, 1884

    You've never read about me in the papers, or in any crime journal. On the streets, they
    call me Madame Soo. Sometimes, to Scotland Yard, I'm the China Doll, or the Invisible Detective.
    They're not entirely a bad lot, I suppose. But when the police find 
    themselves truly baffled, they come to me.

    Thus, when there was an urgent knock on the door of my small parlour off West India Dock Road, I knew precisely who
    would be on the other side.
    
    `),u("Open the door",w("intro2")),u("Wait",w("intro1_1"))},Game.intro1_1=()=>{b(`

    The rap on my door came again, more insistent this time.
    
    `),u("Open the door",w("intro2")),u("Wait",w("intro1_1"))},Game.intro2=()=>{b(`

    Chief Inspector Gould's face appeared in the dim moonlight. "Good evening, Madame Soo," he said, entering as
    swiftly has he could and shutting the door behind him.

    "Good evening, Inspector," I replied. His face was grim.
          
    `),u('"This is scarcely a decent hour."',()=>{b(`
    
    "This is scarcely a decent hour," I said. "Nearly a quarter of eight."

    "True," said the Inspector, "But this is scarcely a decent place. I should be quite gay indeed not to 
    venture deep into Limehouse each time I needed your inimitable skills."

    `),u('"Then I shall assume the matter is of murder."',w("intro3"))}),u(`"Shouldn't you be at the Underwood Club?"`,()=>{b(`
    
    "Shouldn't you be at the Underwood Club?" I asked. "Surely Merrington and his fellows are grieved
    to have lost their favored pigeon at whist."

    "Ha, ha." Gould was less than pleased. "One day I shall be most glad to ascertain how you have come
    to be aware of my whist habits, or my associates, as Underwood is a gentleman's club."

    "You're at a loss as I am no gentleman," I said.

    "For a certainty you are not."
    
    `),u('"Then I shall assume it is a matter of murder."',w("intro3"))})},Game.intro3=()=>{b(`
          
  "Then I shall assume the matter is of murder," I said, "And likely a figure of some importance."

  "You are wholly correct," said Gould, his face grim. "Might I convey the particulars of the case
  on the way? I have a hansom waiting for us." 


    `),u('"I will exact my usual fee, of course."',w("intro4"))},Game.intro4=()=>{b(`
          
  I nodded. "I will exact my usual fee, of course."

  "Per our usual arrangement," said the Inspector. Soon we were out of my parlour and in the hot dark
  of summer in Canary Wharf. The air was thick with tar and cheap tobacco. The work on the dock never
  stops.

  The cabbie nodded as we took our seats, and with a flick of his wrist we were headed
  north. "You've heard of Captain Roger Bennett?"

    `),u(`"Captain Bennett, of the Queen's navy?"`,()=>{b(`
    
    "Captain Bennett, of the Queen's navy?" I replied.

    "The same," said Gould, "Though he was more a privateer than the navy man you've read about in the papers.
    Bennett was a bachelor, living with a housekeeper and a gardener. At about half past six this evening he retired to his
    bedroom. The door to his room was shut and locked. A few minutes later, the housekeeper, a certain
    Mrs. Werstrom, heard an awful scream from the bedroom."
    
    `),u('"Was the door still locked?"',()=>{b(`
        
        "Was the door still locked?" I asked.

        "It was," said Gould, "The gardener, Mr. Thurman, is a capable man and handy with tools. He removed the knob and they
        found Bennett perished by strangulation in his bed."
        
        `),u('"I assume the crime scene is as you found it."',w("intro5"))})}),u(`"I've heard of him."`,()=>{b(`
    
    "I've heard of him," I said.

    Gould nodded. "In truth, he was more a privateer than the navy man you've read about in the papers.
    Bennett was a bachelor, living with a housekeeper and a gardener. At about half past six this evening he retired to his
    bedroom. The door to his room was shut and locked. A few minutes later, the housekeeper, a certain
    Mrs. Werstrom, heard an awful scream from the bedroom."
    
    `),u('"And the door was still locked."',()=>{b(`
        
        "And the door was still locked," I said.

        "It was," said Gould, "The gardener, Mr. Thurman, is a capable man and handy with tools. He removed the knob and they
        found Bennett perished by strangulation in his bed."
        
        `),u('"I assume the crime scene is as you found it."',w("intro5"))})})},Game.intro5=()=>{b(`

      I nodded. "I assume the crime scene is as you found it."

      "Exactly as we found it," said the Inspector. "Mrs. Werstrom and Mr. Thurman are also on hand for you to interview."
    
    `),u('"Excellent!"',w("intro6"))},Game.intro6=()=>{b(`

      "Excellent!" I said. "Thank you, Chief Inspector."

      "I shall only hope you may shed some light on this strange and sinister business," said Gould with a dark scowl.
      
      Soon our hansom arrived at the gate of a wide rolling lawn, blue under the light of the moon. Beyond the lawn
      was a tall manor house, resembling a black shadowy tower by night.

      "Stay here," Gould instructed the cabbie as we departed, "I'll be back shortly."
    
    `),u("Proceed to the manor house",w("intro7"))},Game.intro7=()=>{b(`

      We stood on a wide stone porch before a thick timber door. The door swung open to reveal
      Bixby, Chief Inspector Gould's assistant deputy. Whereas Gould had occasional glimmers
      of brilliance, Bixby had a mind like a lightless cellar.

      "Good news, Chief Inspector," he said. "I've cracked the case. You needn't have retrieved the
      China Doll."
      
    `),u('"Always pleasant to see you as well, Bixby."',()=>{b('"Always pleasant to see you as well, Bixby," I grumbled.'),w("intro8")()}),u('"Hmm. What is your theory, Mr. Bixby?"',()=>{b('I was more curious than offended. "Hmm. What is your theory, Mr. Bixby?"'),w("intro8")()})},Game.intro8=()=>{b(`

      "The case is simplicity itself," said Bixby with a broadening grin. "You know how 
      Mrs. Werstrom found the body?"

      "Yes," nodded Gould.

      "How do we know she isn't the murderer?"

      "The 90 pound, 60-year old housekeeper managed to choke the still-robust captain of
      the Queen's navy," said Gould. "I think we shall have greater success with the
      so-called China Doll, eh Madame Soo?"
      
    `),u("Enter the house",()=>{b(`
    
    "I've business still at Scotland Yard, so I must leave," said Gould to me, "But I shall return later tonight
    to confer with you on your investigation. Bixby," he addressed the assistant deputy, "Please ensure Madame
    Soo has everything she asks for. She is in charge in my absence."

    Bixby mumbled something I was glad to not have heard.
    
    `),w("insideManorHouse")()})},window.addEventListener("load",()=>{var e;r={...Game},(e=document.createElement("div")).className="topBar",e.onclick=t,document.body.appendChild(e),c(),w("start")()});const e=e=>{const[t,a]=e.shift(),[o,n]=e.pop(),s="stack-function-"+h(t);l[s]=()=>{"function"==typeof a?a():b(a),e.map(e=>{var[e,t]=e;{var a=t;const o="d"+h(e);r[o]||u(e,()=>{r[o]=!0,"function"==typeof a?a():b(a)})}}),0===e.map(e=>void 0!==r["d"+h(e[0])]).filter(e=>!0!==e).length&&u(o,()=>{f(),"function"==typeof n?n():b(n)})},u(t,()=>{f(s),l[s]()})},s=()=>{document.getElementsByClassName("main")[0].remove(),r.buttonCount=0},c=()=>{let e=document.getElementsByClassName("topRoot")[0];var t=document.createElement("div"),a=document.createElement("div"),o=document.createElement("btns");e||((e=document.createElement("div")).className="topRoot",document.body.appendChild(e)),e.appendChild(t),t.className="main",t.id="main",a.className="page",a.id="page",o.className="btns",o.id="btns",e.appendChild(t),t.appendChild(a),t.appendChild(o)},u=(o,n,e)=>{var t=document.getElementById("btns");if(!(t&&o&&n))throw"Button could not be constructed! With options: "+o;r.buttonCount||(r.buttonCount=0),r.buttonCount+=1,o=o.trim();var a=document.createElement("button");a.type="button",a.onclick=()=>{var e=document.getElementsByClassName("main")[0].innerHTML,t=(s(),r.isTalking&&(t=l?.state??"talk",a=l[t]["btn-"+o]??0,r.lastButtonPressed=o,l[t]["btn-"+o]=a+1),document.createElement("div")),a=(t.className="outPage",t.id="outPage",t.innerHTML=e,document.getElementsByClassName("topRoot")[0]);a&&a.appendChild(t),setTimeout(()=>{document.getElementById("outPage").remove(),window.scrollTo(0,0),c(),"function"==typeof n?n():b(n),!r.env||!r.isTalking&&r.buttonCount||b(r.env()),!r.buttonCount&&r.lastNode&&u("➜",()=>{r.lastNode&&r.lastNode()})},450)},a.className="button",a.innerHTML=`<div class='buttonText'>${d(o,!0)}</div>`,e?t.prepend(a):t.appendChild(a)},m=e=>e[0].toUpperCase()+e.slice(1);const p=e=>(e=e||r.isTalking,y(e)?[r[e].name,"","",""]:[r[e].name,"a","the","that"]);const y=e=>(e=e||r.isTalking,r[e].hasMet);const f=(e,t)=>{e=e??"talk";t=t||r.isTalking,r[t].state=e,r.isTalking===t&&(r.lastNode=r[t][e])},a=e=>{return e=e||r.currentLocationName,r[e].visited??0},o=e=>{e=e||r.isTalking,r.map||(r.map=[]),r[e]&&r[e].location&&-1===r.map.indexOf(e)&&r.map.push(e)},g=(e,t)=>{u(e,()=>{t?(t(),u("➜",()=>{w(r.currentLocationName)(),r.isTalking=""})):(w(r.currentLocationName)(),r.isTalking="")})};const b=e=>{var t=document.getElementById("page");if(t)if(Array.isArray(e)){var a=e;const s=a[0];var o="i"+(()=>{let e=0;if(0!=s.length)for(i=0;i<s.length;i++){var t=s.charCodeAt(i);e=(e<<5)-e+t,e&=e}return e})(),n=r[o]??0;n?(b(a[n]),n<a.length-1&&(r[o]=n+1)):(r[o]=1,b(s))}else"string"==typeof e?t.innerHTML+=d(e):"function"==typeof e&&(t.innerHTML+=d(e()))},w=t=>{const a=()=>{Object.keys(r).map(e=>{var t,a;r[e]?.location&&r.currentLocationName===r[e]?.location&&(t=(e=>{e=e||r.isTalking;var[t,,a]=p(e),o=r[e].state??"talk";if(!y(e)&&r[e].notMet){if("function"==typeof r[e].notMet)return r[e].notMet();if("object"==typeof r[e].notMet&&r[e].notMet[o]){if("function"==typeof r[e].notMet[o])return r[e].notMet[o]();if("string"==typeof r[e].notMet[o])return r[e].notMet[o]}return r[e].notMet??m(a+` ${t} is here.`)}if("function"==typeof r[e].desc)return r[e].desc();if("object"==typeof r[e].desc&&r[e].desc[o]){if("function"==typeof r[e].desc[o])return r[e].desc[o]();if("string"==typeof r[e].desc[o])return r[e].desc[o]}return r[e].desc??m(a+` ${t} is here.`)})(e),b(t),r[e].talk)&&u((e=>{e=e||r.isTalking;var[t,,a,,]=p(e);return r[e].talkLabel?"string"==typeof r[e].talkLabel?r[e].talkLabel:r[e].talkLabel():`Talk to ${a} `+t})(e),(a=e,()=>{r.isTalking=a,(l=r[a]).hasMet=!0;var e=l?.state??"talk";o(),1!==r?.map?.length||r.showFastTravelTip||(r.showFastTravelTip=1),r[a][e](),r.lastNode=r[a][e]}),!0)})};return()=>{r.currentLocationName=t;var e=()=>{var e=r[t]?.visited??0;r.env=null,r.isTalking="",r[t](),a(),r[t].visited=e+1,1===r.showFastTravelTip&&r[r.map[0]].location!==r.currentLocationName&&(r.showFastTravelTip=2,T("Hey there! You can now fast travel to characters you meet by tapping the top ⤴ of the screen"))};e(),r.lastNode=e}},v=e=>e>=Math.floor(100*Math.random());const k=e=>{var t=`p{${h(e.join("-"))}}`;return r[t]&&r[t]?.length||(r[t]=(e=>{let t=e.length,a;for(;0!=t;)a=Math.floor(Math.random()*t),t--,[e[t],e[a]]=[e[a],e[t]];return e})([...e])),r[t].pop()},T=e=>{const t=document.createElement("div");t.className="tipBox",t.id="tipBox";var a=document.createElement("div"),o=(a.className="tipInnerBox",a.id="tipInnerBox",document.createElement("div"));o.className="tipInnerText",o.id="tipInnerText",o.innerText=e,a.appendChild(o),t.appendChild(a),t.onclick=()=>t.remove(),document.body.appendChild(t)};